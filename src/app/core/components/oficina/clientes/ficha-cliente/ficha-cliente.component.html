<div class="container-general__ficha-cliente">

    <div *ngIf="cargaCliente === 0" class="container-spinner">
        <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="cargaCliente === -1" class="container-error">
        <span class="material-symbols-outlined">warning</span>
        <span class="texto">Ha habido un error al cargar los datos.</span>
        <button mat-button (click)="getCliente()">Reintentar</button>
    </div>

    <div *ngIf="cargaCliente === 1">
        <div class="container-titulo">
            <div class="fill"></div>
            <div class="encapsulador-titulo">
                <h1>{{nuevoCliente ? 'Creación cliente' : cliente.nombre}}</h1>
            </div>
            <div class="container-indicador-creacion">
                <div [matTooltip]="'Debes de rellenar los campos obligatorios (*)'">
                    <span *ngIf="nuevoCliente">Cliente no guardado <span
                            class="material-symbols-outlined">help</span></span>
                </div>
            </div>
        </div>

        <div class="toolbar">
            <button mat-button [disabled]="nuevoCliente" (click)="bajaCliente()">Dar de baja</button>
            <button mat-button (click)="empezarNuevoCliente()">Crear nuevo cliente</button>
        </div>

        <form [formGroup]="formCliente" *ngIf="formCliente">

            <div class="container-izq">

                <div class="fila">
                    <fieldset class="encapsulacion-datos-principales"
                        [ngClass]="((formCliente.get('id_cliente')?.status !== 'DISABLED' && formCliente.get('id_cliente')?.status !== 'VALID')  || !formCliente.get('nombre')?.valid || !formCliente.get('cif')?.valid) ? 'faltan-campos' : ''">
                        <legend>Datos principales</legend>

                        <mat-form-field class="campo-codigo">
                            <mat-label>Código</mat-label>
                            <input matInput formControlName="id_cliente" (input)="editarCampo('id_cliente')">
                        </mat-form-field>

                        <mat-form-field class="campo-nombre">
                            <mat-label>Nombre</mat-label>
                            <input matInput formControlName="nombre" (input)="editarCampo('nombre')">
                            <mat-error *ngIf="formCliente?.get('nombre')?.errors?.['required']">El nombre es
                                obligatorio</mat-error>
                        </mat-form-field>

                        <mat-form-field>
                            <mat-label>Fecha alta</mat-label>
                            <input matInput formControlName="fecha_alta">
                        </mat-form-field>

                        <div class="container-switch">
                            <mat-slide-toggle formControlName="activo"
                                (change)="editarCampo('activo')">Activo</mat-slide-toggle>
                        </div>

                        <mat-form-field class="campo-cif">
                            <mat-label>CIF</mat-label>
                            <input matInput formControlName="cif" (input)="editarCampo('cif')">
                            <mat-error *ngIf="formCliente?.get('cif')?.errors?.['required']">El CIF es
                                obligatorio</mat-error>
                        </mat-form-field>
                    </fieldset>
                </div>

                <div class="fila">
                    <fieldset class="seccion-direccion">
                        <legend>Dirección</legend>

                        <div class="fila-direccion">

                            <mat-form-field>
                                <mat-label>Nombre Comercial</mat-label>
                                <input matInput formControlName="nombre_comercial"
                                    (input)="editarCampo('nombre_comercial')">
                                <mat-error *ngIf="formCliente?.get('nombre_comercial')?.errors?.['required']">El nombre
                                    comercial es
                                    obligatorio</mat-error>
                            </mat-form-field>

                            <mat-form-field>
                                <mat-label>Domicilio</mat-label>
                                <input matInput formControlName="domicilio" (input)="editarCampo('domicilio')">
                                <mat-error *ngIf="formCliente?.get('domicilio')?.errors?.['required']">El domicilio es
                                    obligatorio</mat-error>
                            </mat-form-field>

                            <mat-form-field>
                                <mat-label>Domicilio comercial</mat-label>
                                <input matInput formControlName="domicilio_comercial"
                                    (input)="editarCampo('domicilio_comercial')">
                                <mat-error *ngIf="formCliente?.get('domicilio_comercial')?.errors?.['required']">El
                                    domicilio comercial es
                                    obligatorio</mat-error>
                            </mat-form-field>

                            <mat-form-field class="campo-codigo-postal">
                                <mat-label>Código Postal</mat-label>
                                <input matInput formControlName="codigo_postal" (input)="editarCampo('codigo_postal')">
                            </mat-form-field>

                            <mat-form-field>
                                <mat-label>Localidad</mat-label>
                                <input matInput formControlName="localidad" (input)="editarCampo('localidad')">
                                <mat-error *ngIf="formCliente?.get('localidad')?.errors?.['required']">La localidad es
                                    obligatoria</mat-error>
                            </mat-form-field>

                            <mat-form-field>
                                <mat-label>Persona de Contacto</mat-label>
                                <input matInput formControlName="contacto" (input)="editarCampo('contacto')">
                            </mat-form-field>

                            <mat-form-field>
                                <mat-label>Teléfono 1</mat-label>
                                <input matInput formControlName="telefono_1" (input)="editarCampo('telefono_1')">
                            </mat-form-field>

                            <mat-form-field>
                                <mat-label>Teléfono 2</mat-label>
                                <input matInput formControlName="telefono_2" (input)="editarCampo('telefono_2')">
                            </mat-form-field>

                            <mat-form-field>
                                <mat-label>Email</mat-label>
                                <input matInput formControlName="email" (input)="editarCampo('email')">
                            </mat-form-field>

                            <mat-form-field>
                                <mat-label>Vendedor</mat-label>
                                <input matInput formControlName="id_vendedor" (input)="editarCampo('id_vendedor')">
                            </mat-form-field>

                            <mat-form-field>
                                <mat-label>IBAN</mat-label>
                                <input matInput formControlName="iban" (input)="editarCampo('iban')">
                            </mat-form-field>

                        </div>

                    </fieldset>

                    <fieldset class="seccion-tarifas">
                        <legend>Tarifas</legend>

                        <div class="container-switch">
                            <mat-slide-toggle formControlName="recargo_equivalencia"
                                (change)="editarCampo('recargo_equivalencia')">Recargo Equivalencia</mat-slide-toggle>
                        </div>

                        <div class="container-switch">
                            <mat-slide-toggle formControlName="exento_iva" (change)="editarCampo('exento_iva')">Exento
                                IVA</mat-slide-toggle>
                        </div>

                        <mat-form-field class="campo-descuento">
                            <mat-label>Descuento</mat-label>
                            <input matInput formControlName="descuento" (input)="editarCampo('descuento')">
                            <span matSuffix>%</span>
                            <mat-error *ngIf="formCliente?.get('descuento')?.errors?.['pattern']">El descuento debe
                                ser numérico.</mat-error>
                        </mat-form-field>
                    </fieldset>
                </div>

            </div>

            <div class="container-der">
                <fieldset class="seccion-centros">
                    <legend>Centros</legend>
                    <div class="lista-centros">
                        <ng-container *ngFor="let centro of listaCentros;let index = index">
                            <div class="centro">
                                <div class="izq"><span>{{index+1}}</span></div>
                                <div class="der">
                                    <span>{{centro.nombre}}</span>
                                    <span>{{centro.domicilio}}</span>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                    <button mat-button class="boton-gestionar-centros"><mat-icon>settings</mat-icon>Gestionar
                        centros</button>
                </fieldset>
            </div>

        </form>
    </div>
</div>